import { useState, useEffect } from 'react';
import { FileText, Download, File, FileType, Edit3, Save } from 'lucide-react';
import { motion } from 'framer-motion';
import { useLanguage } from '../contexts/LanguageContext';

// Load templates from localStorage or use default
const getInitialTemplates = () => {
  const saved = localStorage.getItem('documentTemplates');
  if (saved) {
    return JSON.parse(saved);
  }
  
  // Default templates with Indian legal standards
  return {
  contract: {
    name: 'Service Contract',
    template: `SERVICE AGREEMENT

This Service Agreement ("Agreement") is entered into on this ${new Date().toLocaleDateString('en-IN')} between:

PARTY A (Service Provider):
Name: [Enter Name]
Address: [Enter Address]
Phone: [Enter Phone]
Email: [Enter Email]

AND

PARTY B (Client):
Name: [Enter Name]
Address: [Enter Address]
Phone: [Enter Phone]
Email: [Enter Email]

WHEREAS, Party A is engaged in the business of providing services and Party B desires to engage Party A for the provision of services;

NOW, THEREFORE, in consideration of the mutual covenants and agreements contained herein, the parties agree as follows:

1. SCOPE OF SERVICES
Party A agrees to provide the following services to Party B:
[Describe services in detail]

2. TERM
This Agreement shall commence on [Start Date] and shall continue until [End Date], unless terminated earlier in accordance with the terms herein.

3. COMPENSATION
Party B agrees to pay Party A the sum of â‚¹[Amount] (Indian Rupees [Amount in words]) for the services rendered, payable as follows:
[Payment terms]

4. TERMINATION
Either party may terminate this Agreement with [Number] days' written notice to the other party.

5. GOVERNING LAW
This Agreement shall be governed by and construed in accordance with the laws of India, and the courts of [City], India shall have exclusive jurisdiction.

6. ENTIRE AGREEMENT
This Agreement constitutes the entire agreement between the parties and supersedes all prior agreements, understandings, or representations.

IN WITNESS WHEREOF, the parties have executed this Agreement on the date first written above.

PARTY A (Service Provider)          PARTY B (Client)

_________________                    _________________
Signature                            Signature

Name:                                Name:
Date:                                Date:`
  },
  agreement: {
    name: 'Partnership Agreement',
    template: `PARTNERSHIP AGREEMENT

This Partnership Agreement ("Agreement") is made and entered into on ${new Date().toLocaleDateString('en-IN')} by and between:

PARTNER 1:
Name: [Enter Name]
Address: [Enter Address]
PAN: [Enter PAN]
Aadhaar: [Enter Aadhaar]

PARTNER 2:
Name: [Enter Name]
Address: [Enter Address]
PAN: [Enter PAN]
Aadhaar: [Enter Aadhaar]

WHEREAS, the parties desire to form a partnership for the purpose of [Business Purpose];

NOW, THEREFORE, the parties agree as follows:

1. PARTNERSHIP NAME
The partnership shall be known as "[Partnership Name]".

2. BUSINESS PURPOSE
The partnership is formed for the purpose of [Describe business activities].

3. CAPITAL CONTRIBUTION
Partner 1 shall contribute â‚¹[Amount] and Partner 2 shall contribute â‚¹[Amount] to the partnership capital.

4. PROFIT AND LOSS SHARING
Profits and losses shall be shared equally between the partners, unless otherwise agreed.

5. MANAGEMENT
All partners shall have equal rights in the management of the partnership business.

6. DURATION
This partnership shall commence on [Start Date] and shall continue until dissolved by mutual agreement or as provided by law.

7. DISSOLUTION
The partnership may be dissolved by mutual consent of all partners or in accordance with the Indian Partnership Act, 1932.

8. GOVERNING LAW
This Agreement shall be governed by the Indian Partnership Act, 1932, and the laws of India.

IN WITNESS WHEREOF, the parties have executed this Agreement.

PARTNER 1                          PARTNER 2

_________________                   _________________
Signature                           Signature

Name:                               Name:
Date:                               Date:`
  },
  notice: {
    name: 'Legal Notice',
    template: `LEGAL NOTICE

Date: ${new Date().toLocaleDateString('en-IN')}

To,
[Name of Recipient]
[Address]

Subject: Legal Notice under Section 80 of the Code of Civil Procedure, 1908

Dear Sir/Madam,

I, [Your Name], residing at [Your Address], through my advocate [Advocate Name], hereby serve you with this legal notice under Section 80 of the Code of Civil Procedure, 1908.

FACTS:
1. [State relevant facts]
2. [State relevant facts]
3. [State relevant facts]

CLAIMS:
Based on the above facts, you are liable to pay me the following amounts:
1. Principal amount: â‚¹[Amount]
2. Interest: â‚¹[Amount]
3. Damages: â‚¹[Amount]
Total: â‚¹[Total Amount]

DEMAND:
I hereby demand that you:
1. Pay the sum of â‚¹[Total Amount] within [Number] days from the receipt of this notice;
2. Cease and desist from [Action to be stopped];
3. Comply with [Other requirements].

In the event you fail to comply with the above demands within the stipulated time, I shall be constrained to initiate appropriate legal proceedings against you in a court of competent jurisdiction, seeking all available remedies under law, including but not limited to:
- Recovery of the amounts due
- Interest and damages
- Costs of litigation
- Any other relief as the court may deem fit

This notice is being sent without prejudice to my rights and remedies available under law.

Yours faithfully,

[Your Name]
[Your Address]
[Your Phone]
[Your Email]

Through:
[Advocate Name]
[Advocate Address]
[Advocate Phone]
[Advocate Email]`
  },
  rental: {
    name: 'Rental Agreement',
    template: `RENTAL AGREEMENT

This Rental Agreement ("Agreement") is made on ${new Date().toLocaleDateString('en-IN')} between:

LANDLORD:
Name: [Enter Name]
Address: [Enter Address]
Phone: [Enter Phone]
PAN: [Enter PAN]

AND

TENANT:
Name: [Enter Name]
Address: [Enter Address]
Phone: [Enter Phone]
Aadhaar: [Enter Aadhaar]

PROPERTY DETAILS:
Address: [Property Address]
Type: [Residential/Commercial]
Area: [Square Feet/Square Meters]

TERMS AND CONDITIONS:

1. RENT
The monthly rent for the premises is â‚¹[Amount] (Indian Rupees [Amount in words]), payable on or before the [Day] of each month.

2. SECURITY DEPOSIT
The tenant has paid a security deposit of â‚¹[Amount], which shall be refunded at the end of the tenancy period, subject to deductions for any damages.

3. TENURE
This Agreement shall be for a period of [Number] months, commencing from [Start Date] to [End Date].

4. USE OF PREMISES
The tenant shall use the premises solely for [Residential/Commercial] purposes and shall not use it for any illegal activities.

5. MAINTENANCE
The tenant shall maintain the premises in good condition and shall be responsible for any damages caused by negligence.

6. TERMINATION
Either party may terminate this Agreement by giving [Number] days' written notice to the other party.

7. GOVERNING LAW
This Agreement shall be governed by the laws of India and the Rent Control Act applicable in [State/City].

IN WITNESS WHEREOF, the parties have executed this Agreement.

LANDLORD                          TENANT

_________________                 _________________
Signature                         Signature

Name:                             Name:
Date:                             Date:

WITNESSES:

Witness 1:                        Witness 2:
Name:                             Name:
Signature:                        Signature:`
  }
};

function DocumentTemplates() {
  const { t } = useLanguage();
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [documentContent, setDocumentContent] = useState('');
  const [documentName, setDocumentName] = useState('');

  const handleTemplateSelect = (key) => {
    setSelectedTemplate(key);
    setDocumentContent(documentTemplates[key].template);
    setDocumentName(documentTemplates[key].name);
  };

  const exportToPDF = () => {
    // Simple PDF export using browser print
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html>
        <head>
          <title>${documentName}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
            pre { white-space: pre-wrap; font-family: Arial, sans-serif; }
          </style>
        </head>
        <body>
          <pre>${documentContent}</pre>
        </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.print();
  };

  const exportToWord = () => {
    // Create a Word document using Blob
    const content = `
      <html xmlns:o='urn:schemas-microsoft-com:office:office' 
            xmlns:w='urn:schemas-microsoft-com:office:word' 
            xmlns='http://www.w3.org/TR/REC-html40'>
        <head>
          <meta charset='utf-8'>
          <title>${documentName}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
            pre { white-space: pre-wrap; font-family: Arial, sans-serif; }
          </style>
        </head>
        <body>
          <pre>${documentContent}</pre>
        </body>
      </html>
    `;
    
    const blob = new Blob(['\ufeff', content], {
      type: 'application/msword'
    });
    
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `${documentName.replace(/\s+/g, '_')}.doc`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 py-12">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="font-heading text-4xl font-bold text-gray-900 mb-4">
            Legal Document Template Generator
          </h1>
          <p className="text-lg text-gray-600">
            Generate professional legal documents with Indian legal standards
          </p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Template Selection */}
          <div className="lg:col-span-1">
            <div className="card sticky top-4">
              <h2 className="font-heading text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <FileText className="h-6 w-6 text-amber-600" />
                Select Template
              </h2>
              <div className="space-y-3">
                {Object.entries(documentTemplates).map(([key, template]) => (
                  <motion.button
                    key={key}
                    whileHover={{ scale: 1.02, x: 5 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={() => handleTemplateSelect(key)}
                    className={`w-full text-left p-4 rounded-xl transition-all ${
                      selectedTemplate === key
                        ? 'bg-gradient-to-r from-amber-600 to-orange-600 text-white shadow-lg'
                        : 'bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200 hover:shadow-md'
                    }`}
                  >
                    <div className="flex items-center gap-3">
                      <FileType className="h-5 w-5" />
                      <span className="font-semibold">{template.name}</span>
                    </div>
                  </motion.button>
                ))}
              </div>
            </div>
          </div>

          {/* Document Editor */}
          <div className="lg:col-span-2">
            {selectedTemplate ? (
              <div className="card">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="font-heading text-2xl font-bold text-gray-900 flex items-center gap-2">
                    <Edit3 className="h-6 w-6 text-amber-600" />
                    {documentTemplates[selectedTemplate].name}
                  </h2>
                  <div className="flex gap-2">
                    <motion.button
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.95 }}
                      onClick={exportToPDF}
                      className="px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-lg flex items-center gap-2 shadow-md hover:shadow-lg transition-all"
                    >
                      <File className="h-4 w-4" />
                      Export PDF
                    </motion.button>
                    <motion.button
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.95 }}
                      onClick={exportToWord}
                      className="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg flex items-center gap-2 shadow-md hover:shadow-lg transition-all"
                    >
                      <Download className="h-4 w-4" />
                      Export Word
                    </motion.button>
                  </div>
                </div>
                <textarea
                  value={documentContent}
                  onChange={(e) => setDocumentContent(e.target.value)}
                  className="w-full h-[600px] p-4 border border-amber-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 bg-gradient-to-br from-amber-50/50 to-orange-50/50 font-mono text-sm resize-none"
                  placeholder="Select a template to get started..."
                />
                <p className="text-xs text-gray-500 mt-2">
                  ðŸ’¡ Edit the template as needed. Replace placeholders in [brackets] with actual information.
                </p>
              </div>
            ) : (
              <div className="card text-center py-16">
                <FileText className="h-16 w-16 text-gray-300 mx-auto mb-4" />
                <p className="text-gray-500 text-lg">
                  Select a template from the left to get started
                </p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

export default DocumentTemplates;

